#define F_CPU 1000000UL
#include<avr/io.h>
#include<util/delay.h>
#define RBON(A) PORTB |=A
#define RBOFF(A) PORTB &=(~A)
#define RCON(A) PORTC |=A
#define RCOFF(A) PORTC &=(~A)
char buffer[70];
int count;
char u;
char string[] = "HELLO WORLD123 ";
void ledblink()
{
	RBON(32);
	_delay_ms(100);
	RBOFF(32);
	_delay_ms(100);
}
void clock_ser()
{
	RBON(2);
	//_delay_ms(500);
	RBOFF(2);
	//_delay_ms(500);
}

void  clock_ser1()
{
	RBON(2);
	//_delay_ms(100);
	RBOFF(2);
	//_delay_ms(1);
}

void clock_latch()
{
	RBON(4);
	//_delay_ms(1);
	RBOFF(4);
	//_delay_ms(10);;
}

void print()
{      
	 u=0;
	char i,j;
 	char rowsel;
 	for(j = 0; j < 8;j++) {
  		rowsel = 1<<j;
  		PORTC = j;  
  		for(i = 69; i >= 0; i--) {
			if((buffer[i] & rowsel ) ) {
				RBOFF(8);
				clock_ser();
			} else {
				RBON(8);
				clock_ser();
			}
			
  		}
  		clock_latch();
  		for(i = 0;i < 70;i++) {
			RBON(8);
			clock_ser1();
  		}
		
  		clock_latch(); 
		_delay_ms(.1);
  	}
}
void shift()
{
	int i;
	for(i = 0; i < 70; i++ ) {
		buffer[i] = buffer[i+1];
	}
}

void stable_print()
{
	int speed;
	for(speed = 0; speed < 30; speed++) {
		print();
	}
}

void set(char *b)
{
	int i,j,k;
/*
 	buffer[69] = ~(b[4]>>1);
 	buffer[68] = ~(b[3]>>1);
 	buffer[67] = ~(b[2]>>1);
 	buffer[66] = ~(b[1]>>1);
 	buffer[65] = ~(b[0]>>1);
*/
	for(j = 0; j < 5;j++) {
		shift();
		buffer[69] = ~(b[j]>>1);
		stable_print();
	}
	shift();
	buffer[69] = 0x00;
	stable_print();
}

main()
{
	int i;
	char font[59][5] = {
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0x83,  0x7D,   0x7D,   0x7D,   0x83 }, 	
			{0xDD,  0xBD,   0x01,   0xFD,   0xFD },      
			{0xBD,  0x79,   0x75,   0x6D,   0x9D }, 
			{0x7B,  0x7D,   0x5D,   0x4D,   0x33 }, 
			{0xCF,  0xAF,   0x6F,   0xEF,   0x01 }, 
			{0x0B,  0x5D,   0x5D,   0x5D,   0x63 }, 
			{0x83,  0x6D,   0x6D,   0x6D,   0xB3 }, 
			{0x79,  0x77,   0x6F,   0x5F,   0x3F }, 
			{0x93,  0x6D,   0x6D,   0x6D,   0x93 }, 
			{0x9B,  0x6D,   0x6D,   0x6D,   0x83 },  
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xFF,  0xFF, 	0xFF,   0xFF,   0xFF },
			{0xc1,  0xB7,   0x77,   0xB7,   0xC1 },	
			{0x01,  0x6D,   0x6D,   0x6D,   0x93 }, 
			{0x83,  0x7D,   0x7D,   0x7D,   0xBB },    
	               	{0x01,  0x7D,   0x7D,   0xBB,   0xC7 },
	               	{0x01,  0x6D,   0x6D,   0x6D,   0x7D },
	               	{0x01,  0x6F,   0x6F,   0x6F,   0x7F },  
	               	{0x83,  0x7D,   0x65,   0x6D,   0xA3 },
	                {0x01,  0xEF,   0xEF,   0xEF,   0x01 },     
	               	{0x7D,  0x7D,   0x01,   0x7D,   0x7D },
	               	{0xF3,  0x7D,   0x7D,   0x03,   0x7F }, 
	               	{0x01,  0xEF,   0xD7,   0xBB,   0x7D },  
	                {0x01,  0xFD,   0xFD,   0xFD,   0xFD },
	               	{0x01,  0xBF,   0xDF,   0xBF,   0x01 },  
	               	{0x01,  0xBF,   0xDF,   0xEF,   0x01 },
	               	{0x83,  0x7D,   0x7D,   0x7D,   0x83 }, 
	               	{0x01,  0x6F,   0x6F,   0x6F,   0x9F },   
	              	{0x83,  0x7D,   0x75,   0x79,   0x81 }, 
	              	{0x01,  0x6F,   0x6F,   0x6F,   0x91 },    
	              	{0x9B,  0x6D,   0x6D,   0x6D,   0xB3 },
	               	{0x7F,  0x7F,   0x01,   0x7F,   0x7F },
	                {0x03,  0xFD,   0xFD,   0xFD,   0x03 },  
	               	{0x07,  0xFB,   0xFD,   0xFB,   0x07 },
	               	{0x01,  0xFB,   0xF7,   0xFB,   0x01 },   
			{0x39,  0xD7,   0xEF,   0xD7,   0x39 },
			{0x3F,  0xDF,   0xE1,   0xDF,   0x3F },
			{0x79,  0x75,   0x6D,   0x5D,   0x3D } };


	DDRB=0xff;
	DDRC=0xff;
	while(1) {
		for(i = 0; string[i] ;i++) {
			set(font[string[i]-' ']);
		}
	}
}
